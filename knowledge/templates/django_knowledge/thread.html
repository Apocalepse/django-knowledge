{% extends 'django_knowledge/inner.html' %}

{% load markup %}
{% load knowledge_tags %}

{% block title %}{{ question.title }}{% endblock title %}

{% block knowledge_widgets %}

<div class="dk-widget">

  <div class="dk-dialog">
    <div class="the-author gravatar"><img src="{% get_gravatar question.get_email %}" alt="{{ question.get_name }} gravatar"></div>
    <div class="the-content gravatar">
      <h2>{{ question.title }}</h2>
      <h5>{{ question.get_name }} <span class="quiet">
        {% if question.user.is_staff %}&nbsp;<span class="dk-label dk-label-success">staff</span>{% endif %}
        &nbsp;{{ question.added }}
      </span></h5>

      {{ question.body|markdown }}

      {% if request.user.is_staff %}
        <div class="dk-mod-bar">
          {% for mod in allowed_mods.question %}
            <a class="dk-label{% if mod in question.states %} dk-label-warning{% endif %}" href="{% url knowledge_moderate 'question' question.id mod %}">{{ mod }}</a>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div class="clear"></div>

    <br /> 
    <hr class="light"/>
  </div>

  {% for response in responses %}
    <div class="dk-dialog">
      <div class="the-author gravatar smaller"><img src="{% get_gravatar response.get_email 40 %}" alt="{{ response.get_name }} gravatar"></div>
      <div class="the-content gravatar">
        <h5>{{ response.get_name }} <span class="quiet">
          {% if response.accepted %}&nbsp;<span class="dk-label dk-label-warning">accepted answer</span>{% endif %}
          {% if question.user == response.user %}&nbsp;<span class="dk-label dk-label-info">poster</span>{% endif %}
          {% if response.user.is_staff %}&nbsp;<span class="dk-label dk-label-success">staff</span>{% endif %}
          &nbsp;{{ response.added }}
        </span></h5>

        {{ response.body|markdown }}

        {% if request.user.is_staff %}
          <div class="dk-mod-bar">
            {% for mod in allowed_mods.response %}
              <a class="dk-label{% if mod in response.states %} dk-label-warning{% endif %}" href="{% url knowledge_moderate 'response' response.id mod %}">{{ mod }}</a>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p class="center"><em>No responses yet.</em></p>
  {% endfor %}

  <br/> 
  <hr class="light"/>
  <br/> 

  {% if form %}
    {% include "django_knowledge/form.html" with submit_value="Respond to this question" submit_and="we have lots of work to do." %}
  {% else %}
    <p class="center"><em>Please log in to respond.</em></p>
  {% endif %}

</div>

{% endblock knowledge_widgets %}